name: fbutils
kind: chunk
install-commands:
- install -d $DESTDIR/usr/local/fbpackages/utils
- install -m 644 meta-facebook/meta-wedge/recipes-wedge/fbutils/files/ast-functions $DESTDIR/usr/local/fbpackages/utils/ast-functions
- install -d $DESTDIR/usr/local/bin
- binfiles="us_console.sh sol.sh power_led.sh post_led.sh reset_usb.sh mdio.py setup_rov.sh wedge_power.sh wedge_us_mac.sh bcm5396.py bcm5396_util.py setup_switch.py watch-fc.sh"
- for f in ${binfiles}; do install -m 755 meta-facebook/meta-wedge/recipes-wedge/fbutils/files/$f $DESTDIR/usr/local/fbpackages/utils/${f}; ln -s $DESTDIR/usr/local/fbpackages/utils/${f} $DESTDIR/usr/local/bin/${f}; done

# common lib and include files
- install -d $DESTDIR/usr/include/facebook
- install -m 0644 meta-facebook/meta-wedge/recipes-wedge/fbutils/files/src/include/log.h $DESTDIR/usr/include/facebook/log.h
- install -m 0644 meta-facebook/meta-wedge/recipes-wedge/fbutils/files/src/include/i2c-dev.h $DESTDIR/usr/include/facebook/i2c-dev.h

# init
- install -d $DESTDIR/etc/init.d
- install -d $DESTDIR/etc/rcS.d
# script to mount /mnt/data if SD card exists
- install -m 0755 meta-facebook/meta-wedge/recipes-wedge/fbutils/files/mount_data0.sh $DESTDIR/etc/init.d/mount_data0.sh
# TODO: update-rc.d goes here
- install -m 0755 meta-facebook/meta-wedge/recipes-wedge/fbutils/files/rc.early $DESTDIR/etc/init.d/rc.early
# TODO: update-rc.d goes here
- install -m 0755 meta-facebook/meta-wedge/recipes-wedge/fbutils/files/setup-gpio.sh $DESTDIR/etc/init.d/setup-gpio.sh
# TODO: update-rc.d goes here
# create VLAN intf automatically
- install -d $DESTDIR/etc/network/if-up.d
- install -m 755 meta-facebook/meta-wedge/recipes-wedge/fbutils/files/create_vlan_intf $DESTDIR/etc/network/if-up.d/create_vlan_intf
# networking is done after rcS
- install -m 755 meta-facebook/meta-wedge/recipes-wedge/fbutils/files/eth0_mac_fixup.sh $DESTDIR/etc/init.d/eth0_mac_fixup.sh
# TODO: update-rc.d goes here
- install -m 755 meta-facebook/meta-wedge/recipes-wedge/fbutils/files/power-on.sh $DESTDIR/etc/init.d/power-on.sh
# TODO: update-rc.d goes here
- install -m 755 meta-facebook/meta-wedge/recipes-wedge/fbutils/files/fcswitcher.sh $DESTDIR/etc/init.d/fcswitcher.sh
# TODO: update-rc.d goes here
- install -m 755 meta-facebook/meta-wedge/recipes-wedge/fbutils/files/rc.local $DESTDIR/etc/init.d/rc.local
# TODO: update-rc.d goes here


# TODO: After this, the fbutils_0.1.bb script modifies the init files.
# This needs translating to systemd
# TODO: there are a lot of repeated variables above which would be
# better stored once (for readability if nothing else)
